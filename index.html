<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∫∫Â∑•ÊïàÁéáÂàÜÊûêÊä•ÂëäÈó®Êà∑</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', 'SimHei', Arial, sans-serif;
            background: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .search-container {
            background: white;
            padding: 15px 30px;
            border-bottom: 1px solid #e0e0e0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .search-box {
            width: 100%;
            max-width: 500px;
            padding: 10px 15px;
            font-size: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            outline: none;
            transition: border-color 0.3s;
        }

        .search-box:focus {
            border-color: #667eea;
        }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 320px;
            background: white;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .report-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .report-item {
            padding: 12px 15px;
            margin-bottom: 5px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
            border: 1px solid transparent;
            font-size: 14px;
            color: #333;
        }

        .report-item:hover {
            background: #f0f0f0;
        }

        .report-item.active {
            background: #667eea;
            color: white;
            border-color: #5568d3;
        }

        .report-item .report-name {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .report-item .report-path {
            font-size: 12px;
            opacity: 0.7;
        }

        .report-item.active .report-path {
            opacity: 0.9;
        }

        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            overflow: hidden;
        }

        .preview-header {
            padding: 15px 30px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fafafa;
        }

        .preview-title {
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }

        .preview-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .preview-frame {
            flex: 1;
            border: none;
            width: 100%;
            background: white;
        }

        .empty-state {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #999;
            padding: 40px;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 16px;
            text-align: center;
        }

        .count-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: 200px;
            }

            .report-item {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä ‰∫∫Â∑•ÊïàÁéáÂàÜÊûêÊä•ÂëäÈó®Êà∑</h1>
        <p>Labor Efficiency Analysis Reports Portal</p>
    </div>

    <div class="search-container">
        <input 
            type="text" 
            class="search-box" 
            id="searchBox" 
            placeholder="ÊêúÁ¥¢Êä•ÂëäÂêçÁß∞... (Search reports...)"
            autocomplete="off"
        >
    </div>

    <div class="main-container">
        <div class="sidebar">
            <div class="sidebar-header">
                Êä•ÂëäÂàóË°®
                <span class="count-badge" id="reportCount">0</span>
            </div>
            <div class="report-list" id="reportList">
                <!-- Reports will be loaded here -->
            </div>
        </div>

        <div class="content-area">
            <div class="preview-header" id="previewHeader" style="display: none;">
                <div class="preview-title" id="previewTitle">ÈÄâÊã©‰∏Ä‰∏™Êä•ÂëäÊü•Áúã</div>
                <div class="preview-actions">
                    <a href="#" class="btn btn-primary" id="openInNewTab" target="_blank">Âú®Êñ∞Ê†áÁ≠æÊâìÂºÄ</a>
                </div>
            </div>
            <iframe 
                class="preview-frame" 
                id="previewFrame"
                style="display: none;"
            ></iframe>
            <div class="empty-state" id="emptyState">
                <div class="empty-state-icon">üìÑ</div>
                <div class="empty-state-text">
                    <div style="margin-bottom: 10px;">ËØ∑‰ªéÂ∑¶‰æßÂàóË°®ÈÄâÊã©‰∏Ä‰∏™Êä•Âëä</div>
                    <div style="font-size: 14px; opacity: 0.8;">Select a report from the list on the left</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allReports = [];
        let filteredReports = [];
        let currentReport = null;

        // Load manifest
        async function loadManifest() {
            try {
                const response = await fetch('manifest.json');
                if (!response.ok) {
                    throw new Error('Manifest not found');
                }
                const manifest = await response.json();
                return manifest.reports || [];
            } catch (error) {
                console.error('Error loading manifest:', error);
                // Try to scan reports directory (will fail in most browsers, but worth trying)
                return tryScanReports();
            }
        }

        // Fallback: try to scan reports directory (usually won't work in browsers)
        async function tryScanReports() {
            // This is a fallback that typically won't work due to browser security
            // but we include it for completeness
            console.warn('Manifest not available, attempting direct scan (may not work)');
            return [];
        }

        // Initialize
        async function init() {
            allReports = await loadManifest();
            filteredReports = [...allReports];
            updateReportCount();
            renderReports();
            setupSearch();
        }

        // Update report count
        function updateReportCount() {
            document.getElementById('reportCount').textContent = filteredReports.length;
        }

        // Render reports list
        function renderReports() {
            const listContainer = document.getElementById('reportList');
            
            if (filteredReports.length === 0) {
                listContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #999;">Êú™ÊâæÂà∞Êä•Âëä<br><small>No reports found</small></div>';
                return;
            }

            listContainer.innerHTML = filteredReports.map((report, index) => {
                const isActive = currentReport && currentReport.path === report.path;
                const pathEscaped = escapeHtml(report.path).replace(/'/g, "\\'");
                const nameEscaped = escapeHtml(report.name).replace(/'/g, "\\'");
                return `
                    <div class="report-item ${isActive ? 'active' : ''}" 
                         data-path="${escapeHtml(report.path)}" 
                         data-index="${index}"
                         onclick="selectReport('${pathEscaped}', '${nameEscaped}')">
                        <div class="report-name">${escapeHtml(report.name)}</div>
                        <div class="report-path">${escapeHtml(report.path)}</div>
                    </div>
                `;
            }).join('');
        }

        // Select report
        function selectReport(path, name) {
            currentReport = { path, name };
            
            // Update active state
            document.querySelectorAll('.report-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.path === path) {
                    item.classList.add('active');
                }
            });

            // Show preview
            const previewFrame = document.getElementById('previewFrame');
            const previewHeader = document.getElementById('previewHeader');
            const previewTitle = document.getElementById('previewTitle');
            const emptyState = document.getElementById('emptyState');
            const openInNewTab = document.getElementById('openInNewTab');

            previewFrame.src = path;
            previewTitle.textContent = name;
            openInNewTab.href = path;
            
            previewFrame.style.display = 'block';
            previewHeader.style.display = 'flex';
            emptyState.style.display = 'none';
        }

        // Setup search
        function setupSearch() {
            const searchBox = document.getElementById('searchBox');
            searchBox.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase().trim();
                
                if (query === '') {
                    filteredReports = [...allReports];
                } else {
                    filteredReports = allReports.filter(report => 
                        report.name.toLowerCase().includes(query) ||
                        report.path.toLowerCase().includes(query)
                    );
                }
                
                updateReportCount();
                renderReports();
            });
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

