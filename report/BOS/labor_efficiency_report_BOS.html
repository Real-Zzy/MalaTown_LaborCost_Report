<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>BOS门店人工效率分析报告</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', 'SimHei', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
        }
        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.5);
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
        }
        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
        }
        .section {
            background: white;
            padding: 25px;
            margin-bottom: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section h2 {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            margin-top: 0;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .metric-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .metric-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }
        .metric-card .label {
            font-size: 1.1em;
            color: #666;
        }
        .chart-container {
            text-align: center;
            margin: 30px 0;
        }
        .chart-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        table th, table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        table th {
            background-color: #667eea;
            color: white;
            font-weight: bold;
        }
        table tr:hover {
            background-color: #f5f5f5;
        }
        .highlight {
            background-color: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
            border-radius: 4px;
        }
        .insight {
            background-color: #d1ecf1;
            padding: 15px;
            border-left: 4px solid #0c5460;
            margin: 15px 0;
            border-radius: 4px;
        }
        .recommendation {
            background-color: #d4edda;
            padding: 15px;
            border-left: 4px solid #28a745;
            margin: 15px 0;
            border-radius: 4px;
        }
        .footer {
            text-align: center;
            color: #666;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        .chart-tabs {
            margin-top: 20px;
        }
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }
        .tab-button {
            padding: 12px 24px;
            background: #f0f0f0;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: #666;
            transition: all 0.3s;
        }
        .tab-button:hover {
            background: #e0e0e0;
        }
        .tab-button.active {
            background: white;
            color: #667eea;
            border-bottom-color: #667eea;
        }
        .confirm-btn {
            padding: 8px 20px;
            font-size: 1em;
            border: 2px solid rgba(255,255,255,0.8);
            border-radius: 5px;
            background: rgba(255,255,255,0.9);
            color: #667eea;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .confirm-btn:hover {
            background: white;
            border-color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .confirm-btn:active {
            transform: translateY(0);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .chart-image {
            text-align: center;
            margin: 20px 0;
        }
        .chart-image img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        // Global variables
        var allData = [];
        var chartInstances = {};
        var currentFilteredData = [];
        
        // Initialize date selectors with default values
        document.addEventListener('DOMContentLoaded', function() {
            // Load all data
            try {
                var dataElement = document.getElementById('allData');
                if (dataElement) {
                    allData = JSON.parse(dataElement.textContent);
                }
            } catch (e) {
                console.error('Error loading data:', e);
                return;
            }
            
            var startSelect = document.getElementById('startDate');
            var endSelect = document.getElementById('endDate');
            
            if (allData && allData.length > 0) {
                // Sort data by start_date to ensure correct first and last dates
                var sortedData = allData.slice().sort(function(a, b) {
                    return new Date(a.start_date) - new Date(b.start_date);
                });
                // Set default to first and last dates
                var firstDate = sortedData[0].start_date.split('T')[0];
                var lastDate = sortedData[sortedData.length - 1].start_date.split('T')[0];
                startSelect.value = firstDate;
                endSelect.value = lastDate;
                
                // Wait for Chart.js to be ready, then update
                function initializeCharts() {
                    if (typeof Chart !== 'undefined') {
                updateDateRange();
                    } else {
                        setTimeout(initializeCharts, 100);
                    }
                }
                initializeCharts();
            }
        });
        
        function switchTab(tabName, buttonElement) {
            // Hide all tabs
            var tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Remove active from all buttons
            var buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            document.getElementById('tab-' + tabName).classList.add('active');
            buttonElement.classList.add('active');
            
            // Update charts for the active tab with current filtered data
            updateCharts(currentFilteredData.length > 0 ? currentFilteredData : allData);
        }
        
        function updateDateRange() {
            var startDate = document.getElementById('startDate').value;
            var endDate = document.getElementById('endDate').value;
            
            if (!startDate || !endDate) {
                return;
            }
            
            // Filter data by date range
            var filteredData = allData.filter(function(item) {
                var itemStart = item.start_date.split('T')[0];
                return itemStart >= startDate && itemStart <= endDate;
            });
            
            // Store current filtered data for use by switchTab
            currentFilteredData = filteredData;
            
            // Update date range display
            var startDisplay = document.querySelector('#startDate option:checked').text;
            var endDisplay = document.querySelector('#endDate option:checked').text;
            document.getElementById('dateRangeDisplay').textContent = startDisplay + ' - ' + endDisplay;
            
            // Update all sections with filtered data
            updateSummaryMetrics(filteredData);
            updateKeyMetrics(filteredData);
            updatePeriodTable(filteredData);
            updateCharts(filteredData);
        }
        
        function updateSummaryMetrics(data) {
            if (data.length === 0) return;
            
            var totalSales = data.reduce((sum, item) => sum + (item.net_sales || 0), 0);
            var totalLaborCost = data.reduce((sum, item) => sum + (item.total_labor_cost || 0), 0);
            var avgLaborCostPct = totalSales > 0 ? (totalLaborCost / totalSales * 100) : 0;
            var totalHours = data.reduce((sum, item) => sum + (item.total_Labor_hour || 0), 0);
            var avgSplh = data.reduce((sum, item) => sum + (item.sales_per_labor_hour || 0), 0) / data.length;
            
            // Update metric cards
            var cards = document.querySelectorAll('.metric-card .value');
            if (cards.length >= 5) {
                cards[0].textContent = '$' + totalSales.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                cards[1].textContent = '$' + totalLaborCost.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                cards[2].textContent = avgLaborCostPct.toFixed(2) + '%';
                cards[3].textContent = totalHours.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                cards[4].textContent = '$' + avgSplh.toFixed(2);
            }
        }
        
        function updateKeyMetrics(data) {
            if (data.length === 0) return;
            
            var laborCostPcts = data.map(item => item.labor_cost_pct || 0);
            var splhs = data.map(item => item.sales_per_labor_hour || 0);
            var avgLaborCostPct = laborCostPcts.reduce((a, b) => a + b, 0) / laborCostPcts.length;
            var minLaborCostPct = Math.min(...laborCostPcts);
            var maxLaborCostPct = Math.max(...laborCostPcts);
            var minPeriod = data[laborCostPcts.indexOf(minLaborCostPct)];
            var maxPeriod = data[laborCostPcts.indexOf(maxLaborCostPct)];
            var stdDev = Math.sqrt(laborCostPcts.reduce((sq, n) => sq + Math.pow(n - avgLaborCostPct, 2), 0) / laborCostPcts.length);
            var avgSplh = splhs.reduce((a, b) => a + b, 0) / splhs.length;
            var maxSplh = Math.max(...splhs);
            var minSplh = Math.min(...splhs);
            var maxSplhPeriod = data[splhs.indexOf(maxSplh)];
            var minSplhPeriod = data[splhs.indexOf(minSplh)];
            var avgOvertimePct = data.reduce((sum, item) => sum + (item.overtime_pct || 0), 0) / data.length;
            var totalOvertime = data.reduce((sum, item) => sum + (item.OT_hour || 0), 0);
            var avgHC = data.reduce((sum, item) => sum + (item.HC || 0), 0) / data.length;
            
            // Update key metrics table
            var table = document.getElementById('keyMetricsTable');
            if (table) {
                var rows = table.getElementsByTagName('tr');
                if (rows.length > 1) rows[1].cells[1].textContent = data.length + ' 个';
                if (rows.length > 2) rows[2].cells[1].textContent = avgLaborCostPct.toFixed(2) + '%';
                if (rows.length > 3) rows[3].cells[1].textContent = minLaborCostPct.toFixed(2) + '% (时间段: ' + (minPeriod ? minPeriod.Period : '') + ')';
                if (rows.length > 4) rows[4].cells[1].textContent = maxLaborCostPct.toFixed(2) + '% (时间段: ' + (maxPeriod ? maxPeriod.Period : '') + ')';
                if (rows.length > 5) rows[5].cells[1].textContent = stdDev.toFixed(2) + '%';
                if (rows.length > 6) rows[6].cells[1].textContent = '$' + avgSplh.toFixed(2);
                if (rows.length > 7) rows[7].cells[1].textContent = '$' + maxSplh.toFixed(2) + ' (时间段: ' + (maxSplhPeriod ? maxSplhPeriod.Period : '') + ')';
                if (rows.length > 8) rows[8].cells[1].textContent = '$' + minSplh.toFixed(2) + ' (时间段: ' + (minSplhPeriod ? minSplhPeriod.Period : '') + ')';
                if (rows.length > 9) rows[9].cells[1].textContent = avgOvertimePct.toFixed(2) + '%';
                if (rows.length > 10) rows[10].cells[1].textContent = totalOvertime.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + ' 小时';
                if (rows.length > 11) rows[11].cells[1].textContent = avgHC.toFixed(1) + ' 人';
            }
        }
        
        function updatePeriodTable(data) {
            var tbody = document.getElementById('periodTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Calculate change percentages
            var sortedData = data.slice().sort((a, b) => new Date(a.start_date) - new Date(b.start_date));
            
            for (var i = 0; i < sortedData.length; i++) {
                var row = sortedData[i];
                var otChange = 0;
                var costChange = 0;
                
                if (i > 0) {
                    var prevRow = sortedData[i-1];
                    if (prevRow.OT_hour > 0) {
                        otChange = ((row.OT_hour - prevRow.OT_hour) / prevRow.OT_hour) * 100;
                    }
                    if (prevRow.total_labor_cost > 0) {
                        costChange = ((row.total_labor_cost - prevRow.total_labor_cost) / prevRow.total_labor_cost) * 100;
                    }
                }
                
                var otColor = otChange > 0 ? '#e74c3c' : (otChange < 0 ? '#27ae60' : '#333');
                var otSign = otChange > 0 ? '+' : '';
                var otText = i > 0 ? otSign + otChange.toFixed(2) + '%' : '-';
                
                var costColor = costChange > 0 ? '#e74c3c' : (costChange < 0 ? '#27ae60' : '#333');
                var costSign = costChange > 0 ? '+' : '';
                var costText = i > 0 ? costSign + costChange.toFixed(2) + '%' : '-';
                
                var tr = document.createElement('tr');
                tr.setAttribute('data-period', row.Period);
                tr.innerHTML = `
                    <td>${row.Period}</td>
                    <td>$${(row.net_sales || 0).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td>$${(row.total_labor_cost || 0).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td>${(row.labor_cost_pct || 0).toFixed(2)}%</td>
                    <td>$${(row.sales_per_labor_hour || 0).toFixed(2)}</td>
                    <td>${(row.total_Labor_hour || 0).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td>${(row.OT_hour || 0).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td>${(row.overtime_pct || 0).toFixed(2)}%</td>
                    <td>${(row.HC || 0).toFixed(0)}</td>
                    <td style="color: ${otColor}; font-weight: bold;">${otText}</td>
                    <td style="color: ${costColor}; font-weight: bold;">${costText}</td>
                `;
                tbody.appendChild(tr);
            }
        }
        
        function updateCharts(data) {
            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined') {
                console.error('Chart.js is not loaded');
                return;
            }
            
            // Get filtered data or use all data
            var chartData = data || allData;
            if (!chartData || chartData.length === 0) {
                console.warn('No chart data available');
                return;
            }
            
            // Sort data by start_date
            var sortedData = chartData.slice().sort((a, b) => new Date(a.start_date) - new Date(b.start_date));
            var periodLabels = sortedData.map(item => item.Period);
            
            // Update charts for each tab
            updateTotalChart(sortedData, periodLabels);
            updateLaborCostChart(sortedData, periodLabels);
            updateSplhChart(sortedData, periodLabels);
            updateOvertimeChart(sortedData, periodLabels);
        }
        
        function updateTotalChart(data, labels) {
            var ctx = document.getElementById('totalChart');
            if (!ctx) return;
            
            if (chartInstances['total']) {
                chartInstances['total'].destroy();
            }
            
            chartInstances['total'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'net_sales',
                            data: data.map(item => item.net_sales || 0),
                            backgroundColor: 'rgba(155, 89, 182, 0.7)',
                            yAxisID: 'y'
                        },
                        {
                            label: 'labor_cost',
                            data: data.map(item => item.total_labor_cost || 0),
                            backgroundColor: 'rgba(255, 165, 0, 0.7)',
                            yAxisID: 'y'
                        },
                        {
                            label: 'labor_cost/net_sales',
                            data: data.map(item => item.labor_cost_pct || 0),
                            type: 'line',
                            borderColor: 'rgb(231, 76, 60)',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            yAxisID: 'y1',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Bi-Weekly Labor Report',
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    var label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.datasetIndex < 2) {
                                        label += '$' + context.parsed.y.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                                    } else {
                                        label += context.parsed.y.toFixed(2) + '%';
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'labor_cost | net_sales ($)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'labor_cost/net_sales (%)'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }
        
        function updateLaborCostChart(data, labels) {
            var ctx = document.getElementById('laborCostChart');
            if (!ctx) return;
            
            if (chartInstances['labor_cost']) {
                chartInstances['labor_cost'].destroy();
            }
            
            chartInstances['labor_cost'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'labor_cost/net_sales',
                            data: data.map(item => item.labor_cost_pct || 0),
                            backgroundColor: 'rgba(52, 152, 219, 0.7)',
                            yAxisID: 'y'
                        },
                        {
                            label: 'labor_cost',
                            data: data.map(item => item.total_labor_cost || 0),
                            backgroundColor: 'rgba(255, 215, 0, 0.7)',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'labor_cost/net_sales and labor_cost by Period',
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    var label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.datasetIndex === 0) {
                                        label += context.parsed.y.toFixed(2) + '%';
                                    } else {
                                        label += '$' + context.parsed.y.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'labor_cost/net_sales (%)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'labor_cost ($)'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }
        
        function updateSplhChart(data, labels) {
            var ctx = document.getElementById('splhChart');
            if (!ctx) return;
            
            if (chartInstances['splh']) {
                chartInstances['splh'].destroy();
            }
            
            chartInstances['splh'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'SPLH',
                            data: data.map(item => item.sales_per_labor_hour || 0),
                            backgroundColor: 'rgba(52, 152, 219, 0.7)',
                            yAxisID: 'y'
                        },
                        {
                            label: 'net_sales',
                            data: data.map(item => item.net_sales || 0),
                            backgroundColor: 'rgba(255, 165, 0, 0.7)',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'SPLH and net_sales by Period',
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    var label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.datasetIndex === 0) {
                                        label += '$' + context.parsed.y.toFixed(2);
                                    } else {
                                        label += '$' + context.parsed.y.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'SPLH ($)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'net_sales ($)'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }
        
        function updateOvertimeChart(data, labels) {
            var ctx = document.getElementById('overtimeChart');
            if (!ctx) return;
            
            if (chartInstances['overtime']) {
                chartInstances['overtime'].destroy();
            }
            
            // Calculate percentages
            var otPcts = data.map(item => {
                var total = item.total_Labor_hour || 0;
                var ot = item.OT_hour || 0;
                return total > 0 ? (ot / total * 100) : 0;
            });
            var regularPcts = data.map(item => {
                var total = item.total_Labor_hour || 0;
                var ot = item.OT_hour || 0;
                return total > 0 ? ((total - ot) / total * 100) : 0;
            });
            
            chartInstances['overtime'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'total_Labor_hour',
                            data: regularPcts,
                            backgroundColor: 'rgba(46, 204, 113, 0.7)',
                            stack: 'stack1'
                        },
                        {
                            label: 'OT_hour',
                            data: otPcts,
                            backgroundColor: 'rgba(255, 215, 0, 0.7)',
                            stack: 'stack1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'OT_hour and total_Labor_hour by Period',
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    var label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += context.parsed.y.toFixed(2) + '%';
                                    return label;
                                },
                                afterBody: function(context) {
                                    var index = context[0].dataIndex;
                                    var item = data[index];
                                    return [
                                        'OT: ' + (item.OT_hour || 0).toFixed(0) + 'h',
                                        'Total: ' + (item.total_Labor_hour || 0).toFixed(0) + 'h'
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            stacked: true,
                            max: 100,
                            title: {
                                display: true,
                                text: '百分比 (%)'
                            }
                        }
                    }
                }
            });
        }
    </script>
</head>
<body>
    <div class="header">
        <a href="../index.html" class="back-button">← 返回主界面</a>
        <h1>BOS门店人工效率分析报告</h1>
        <div style="margin-top: 20px; display: flex; align-items: center; justify-content: center; gap: 15px; flex-wrap: wrap;">
            <label for="startDate" style="font-size: 1.1em;">分析期间：</label>
            <select id="startDate" style="padding: 8px 15px; font-size: 1em; border: 2px solid rgba(255,255,255,0.5); border-radius: 5px; background: rgba(255,255,255,0.2); color: white; cursor: pointer;">
                <option value="">选择开始日期</option>
                <option value="2025-01-06">2025年01月06日</option>
                <option value="2025-01-20">2025年01月20日</option>
                <option value="2025-02-03">2025年02月03日</option>
                <option value="2025-02-17">2025年02月17日</option>
                <option value="2025-03-03">2025年03月03日</option>
                <option value="2025-03-17">2025年03月17日</option>
                <option value="2025-03-31">2025年03月31日</option>
                <option value="2025-04-14">2025年04月14日</option>
                <option value="2025-04-28">2025年04月28日</option>
                <option value="2025-05-12">2025年05月12日</option>
                <option value="2025-05-26">2025年05月26日</option>
                <option value="2025-06-09">2025年06月09日</option>
                <option value="2025-06-23">2025年06月23日</option>
                <option value="2025-07-07">2025年07月07日</option>
                <option value="2025-07-21">2025年07月21日</option>
                <option value="2025-08-04">2025年08月04日</option>
                <option value="2025-08-18">2025年08月18日</option>
                <option value="2025-09-01">2025年09月01日</option>
                <option value="2025-09-15">2025年09月15日</option>
                <option value="2025-09-29">2025年09月29日</option>
                <option value="2025-10-13">2025年10月13日</option>
                <option value="2025-10-27">2025年10月27日</option>
                <option value="2025-11-10">2025年11月10日</option>
            </select>
            <span style="font-size: 1.1em;">至</span>
            <select id="endDate" style="padding: 8px 15px; font-size: 1em; border: 2px solid rgba(255,255,255,0.5); border-radius: 5px; background: rgba(255,255,255,0.2); color: white; cursor: pointer;">
                <option value="">选择结束日期</option>
                <option value="2025-01-06">2025年01月06日</option>
                <option value="2025-01-20">2025年01月20日</option>
                <option value="2025-02-03">2025年02月03日</option>
                <option value="2025-02-17">2025年02月17日</option>
                <option value="2025-03-03">2025年03月03日</option>
                <option value="2025-03-17">2025年03月17日</option>
                <option value="2025-03-31">2025年03月31日</option>
                <option value="2025-04-14">2025年04月14日</option>
                <option value="2025-04-28">2025年04月28日</option>
                <option value="2025-05-12">2025年05月12日</option>
                <option value="2025-05-26">2025年05月26日</option>
                <option value="2025-06-09">2025年06月09日</option>
                <option value="2025-06-23">2025年06月23日</option>
                <option value="2025-07-07">2025年07月07日</option>
                <option value="2025-07-21">2025年07月21日</option>
                <option value="2025-08-04">2025年08月04日</option>
                <option value="2025-08-18">2025年08月18日</option>
                <option value="2025-09-01">2025年09月01日</option>
                <option value="2025-09-15">2025年09月15日</option>
                <option value="2025-09-29">2025年09月29日</option>
                <option value="2025-10-13">2025年10月13日</option>
                <option value="2025-10-27">2025年10月27日</option>
                <option value="2025-11-10">2025年11月10日</option>
            </select>
            <button id="confirmDateBtn" onclick="updateDateRange()" class="confirm-btn" style="margin-left: 10px;">确认</button>
            <span id="dateRangeDisplay" style="font-size: 1.1em; margin-left: 10px;">2025年01月06日 - 2025年11月10日</span>
        </div>
        <p>报告生成时间：2026年01月13日</p>
    </div>
    
    <!-- Embed all data as JSON for JavaScript filtering -->
    <script type="application/json" id="allData">
[
  {
    "Period": "1/6-1/19",
    "Tips": 3153.66,
    "net_sales": 70209.39,
    "service_fee": null,
    "total_payroll": 27570.58,
    "Tips_Distributed": 3290.66,
    "if_match": 137.0,
    "LaborCost_no_tips": 24279.92,
    "labor_cost/net_sales": 0.3458215489,
    "total_Labor_hour": 942.62,
    "OT_hour": 39.11,
    "SPLH": 74.48,
    "HC": 19.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 24279.92,
    "TotalLaborCost/NetSales": 0.3458215489,
    "Unnamed: 23": null,
    "BOS（Boston）": "平均 Labor Cost 占比：27.36%，偏高；",
    "start_date": "2025-01-06T00:00:00",
    "end_date": "2025-01-19T00:00:00",
    "MP_LaborCost": 24279.92,
    "MP_TotalLaborCostExcludingTips": 24279.92,
    "total_labor_cost": 24279.92,
    "labor_cost_pct": 34.58215489409607,
    "sales_per_labor_hour": 74.48323820839786,
    "labor_cost_per_hour": 25.7579088073667,
    "overtime_pct": 4.149073857970338,
    "period_midpoint": "2025-01-12T12:00:00"
  },
  {
    "Period": "1/20-2/2",
    "Tips": 4268.15,
    "net_sales": 91127.19,
    "service_fee": null,
    "total_payroll": 29383.0,
    "Tips_Distributed": 4391.15,
    "if_match": 123.0,
    "LaborCost_no_tips": 24991.85,
    "labor_cost/net_sales": 0.2742523938,
    "total_Labor_hour": 985.56,
    "OT_hour": 44.37,
    "SPLH": 92.46,
    "HC": 21.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 24991.85,
    "TotalLaborCost/NetSales": 0.2742523938,
    "Unnamed: 23": null,
    "BOS（Boston）": null,
    "start_date": "2025-01-20T00:00:00",
    "end_date": "2025-02-02T00:00:00",
    "MP_LaborCost": 24991.85,
    "MP_TotalLaborCostExcludingTips": 24991.85,
    "total_labor_cost": 24991.85,
    "labor_cost_pct": 27.425239382449956,
    "sales_per_labor_hour": 92.46234628028736,
    "labor_cost_per_hour": 25.35801980599862,
    "overtime_pct": 4.50200901010593,
    "period_midpoint": "2025-01-26T12:00:00"
  },
  {
    "Period": "2/3-2/16",
    "Tips": 3657.12,
    "net_sales": 100159.83,
    "service_fee": null,
    "total_payroll": 29210.3,
    "Tips_Distributed": 3969.5,
    "if_match": 312.38,
    "LaborCost_no_tips": 25240.8,
    "labor_cost/net_sales": 0.2520052201,
    "total_Labor_hour": 984.54,
    "OT_hour": 87.88,
    "SPLH": 101.73,
    "HC": 16.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": 6216.25,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 6216.25,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 31457.05,
    "TotalLaborCost/NetSales": 0.3140685243,
    "Unnamed: 23": null,
    "BOS（Boston）": "平均 SPLH：$92.62，接近平均；",
    "start_date": "2025-02-03T00:00:00",
    "end_date": "2025-02-16T00:00:00",
    "MP_LaborCost": 25240.8,
    "MP_TotalLaborCostExcludingTips": 31457.05,
    "total_labor_cost": 31457.05,
    "labor_cost_pct": 31.406852427764704,
    "sales_per_labor_hour": 101.73261624718143,
    "labor_cost_per_hour": 31.95101265565645,
    "overtime_pct": 8.92599589656083,
    "period_midpoint": "2025-02-09T12:00:00"
  },
  {
    "Period": "2/17-3/2",
    "Tips": 4099.1,
    "net_sales": 116889.35,
    "service_fee": null,
    "total_payroll": 30857.58,
    "Tips_Distributed": 4434.33,
    "if_match": 335.23,
    "LaborCost_no_tips": 26423.25,
    "labor_cost/net_sales": 0.2260535284,
    "total_Labor_hour": 1046.81,
    "OT_hour": 36.06,
    "SPLH": 111.66,
    "HC": 17.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": 6216.25,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 6216.25,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 32639.5,
    "TotalLaborCost/NetSales": 0.2792341646,
    "Unnamed: 23": null,
    "BOS（Boston）": null,
    "start_date": "2025-02-17T00:00:00",
    "end_date": "2025-03-02T00:00:00",
    "MP_LaborCost": 26423.25,
    "MP_TotalLaborCostExcludingTips": 32639.5,
    "total_labor_cost": 32639.5,
    "labor_cost_pct": 27.923416461807683,
    "sales_per_labor_hour": 111.66243157784126,
    "labor_cost_per_hour": 31.179965800861666,
    "overtime_pct": 3.4447511964922004,
    "period_midpoint": "2025-02-23T12:00:00"
  },
  {
    "Period": "3/3-3/16",
    "Tips": 3783.14,
    "net_sales": 105788.37,
    "service_fee": null,
    "total_payroll": 29448.36,
    "Tips_Distributed": 3967.51,
    "if_match": 184.37,
    "LaborCost_no_tips": 25480.85,
    "labor_cost/net_sales": 0.2408662691,
    "total_Labor_hour": 1019.15,
    "OT_hour": 17.97,
    "SPLH": 103.8,
    "HC": 20.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 25480.85,
    "TotalLaborCost/NetSales": 0.2408662691,
    "Unnamed: 23": null,
    "BOS（Boston）": "波动特征：",
    "start_date": "2025-03-03T00:00:00",
    "end_date": "2025-03-16T00:00:00",
    "MP_LaborCost": 25480.85,
    "MP_TotalLaborCostExcludingTips": 25480.85,
    "total_labor_cost": 25480.85,
    "labor_cost_pct": 24.086626913714618,
    "sales_per_labor_hour": 103.80058872589903,
    "labor_cost_per_hour": 25.002060540646617,
    "overtime_pct": 1.7632340676053575,
    "period_midpoint": "2025-03-09T12:00:00"
  },
  {
    "Period": "3/17-3/30",
    "Tips": 4270.24,
    "net_sales": 113115.75,
    "service_fee": null,
    "total_payroll": 34296.66,
    "Tips_Distributed": 5273.45,
    "if_match": 1003.21,
    "LaborCost_no_tips": 29023.21,
    "labor_cost/net_sales": 0.2565797424,
    "total_Labor_hour": 1182.19,
    "OT_hour": 66.0,
    "SPLH": 95.68,
    "HC": 19.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 29023.21,
    "TotalLaborCost/NetSales": 0.2565797424,
    "Unnamed: 23": null,
    "BOS（Boston）": null,
    "start_date": "2025-03-17T00:00:00",
    "end_date": "2025-03-30T00:00:00",
    "MP_LaborCost": 29023.21,
    "MP_TotalLaborCostExcludingTips": 29023.21,
    "total_labor_cost": 29023.21,
    "labor_cost_pct": 25.657974243197785,
    "sales_per_labor_hour": 95.68322350891142,
    "labor_cost_per_hour": 24.55037684297786,
    "overtime_pct": 5.582858931305458,
    "period_midpoint": "2025-03-23T12:00:00"
  },
  {
    "Period": "3/31-4/13",
    "Tips": 4332.27,
    "net_sales": 112483.31,
    "service_fee": null,
    "total_payroll": 30304.26,
    "Tips_Distributed": 4949.48,
    "if_match": 617.21,
    "LaborCost_no_tips": 25354.78,
    "labor_cost/net_sales": 0.2254092629,
    "total_Labor_hour": 1020.72,
    "OT_hour": 38.16,
    "SPLH": 110.2,
    "HC": 20.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 25354.78,
    "TotalLaborCost/NetSales": 0.2254092629,
    "Unnamed: 23": null,
    "BOS（Boston）": "Labor Cost 呈现“U形趋势”，中期达到最低后快速反弹；",
    "start_date": "2025-03-31T00:00:00",
    "end_date": "2025-04-13T00:00:00",
    "MP_LaborCost": 25354.78,
    "MP_TotalLaborCostExcludingTips": 25354.78,
    "total_labor_cost": 25354.78,
    "labor_cost_pct": 22.540926293865287,
    "sales_per_labor_hour": 110.19996669017948,
    "labor_cost_per_hour": 24.84009326749745,
    "overtime_pct": 3.7385375029391015,
    "period_midpoint": "2025-04-06T12:00:00"
  },
  {
    "Period": "4/14-4/27",
    "Tips": 5417.46,
    "net_sales": 120931.25,
    "service_fee": null,
    "total_payroll": 33067.38,
    "Tips_Distributed": 6410.05,
    "if_match": 992.59,
    "LaborCost_no_tips": 26657.33,
    "labor_cost/net_sales": 0.2204337589,
    "total_Labor_hour": 1076.05,
    "OT_hour": 13.55,
    "SPLH": 112.38,
    "HC": 18.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 26657.33,
    "TotalLaborCost/NetSales": 0.2204337589,
    "Unnamed: 23": null,
    "BOS（Boston）": null,
    "start_date": "2025-04-14T00:00:00",
    "end_date": "2025-04-27T00:00:00",
    "MP_LaborCost": 26657.33,
    "MP_TotalLaborCostExcludingTips": 26657.33,
    "total_labor_cost": 26657.33,
    "labor_cost_pct": 22.043375885058662,
    "sales_per_labor_hour": 112.38441522234098,
    "labor_cost_per_hour": 24.773319083685706,
    "overtime_pct": 1.2592351656521539,
    "period_midpoint": "2025-04-20T12:00:00"
  },
  {
    "Period": "4/28-5/11",
    "Tips": 4612.45,
    "net_sales": 113057.96,
    "service_fee": null,
    "total_payroll": 31227.95,
    "Tips_Distributed": 5615.12,
    "if_match": 1002.67,
    "LaborCost_no_tips": 25612.83,
    "labor_cost/net_sales": 0.2265460123,
    "total_Labor_hour": 1034.67,
    "OT_hour": 8.62,
    "SPLH": 109.27,
    "HC": 18.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 25612.83,
    "TotalLaborCost/NetSales": 0.2265460123,
    "Unnamed: 23": null,
    "BOS（Boston）": null,
    "start_date": "2025-04-28T00:00:00",
    "end_date": "2025-05-11T00:00:00",
    "MP_LaborCost": 25612.83,
    "MP_TotalLaborCostExcludingTips": 25612.83,
    "total_labor_cost": 25612.83,
    "labor_cost_pct": 22.65460123285437,
    "sales_per_labor_hour": 109.26958353871282,
    "labor_cost_per_hour": 24.75458841949607,
    "overtime_pct": 0.833115872693709,
    "period_midpoint": "2025-05-04T12:00:00"
  },
  {
    "Period": "5/12-5/25",
    "Tips": 4996.67,
    "net_sales": 100532.08,
    "service_fee": null,
    "total_payroll": 30738.5,
    "Tips_Distributed": 5885.89,
    "if_match": 889.22,
    "LaborCost_no_tips": 24852.61,
    "labor_cost/net_sales": 0.2472107411,
    "total_Labor_hour": 999.94,
    "OT_hour": 11.98,
    "SPLH": 100.54,
    "HC": 18.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 24852.61,
    "TotalLaborCost/NetSales": 0.2472107411,
    "Unnamed: 23": null,
    "BOS（Boston）": null,
    "start_date": "2025-05-12T00:00:00",
    "end_date": "2025-05-25T00:00:00",
    "MP_LaborCost": 24852.61,
    "MP_TotalLaborCostExcludingTips": 24852.61,
    "total_labor_cost": 24852.61,
    "labor_cost_pct": 24.721074108881464,
    "sales_per_labor_hour": 100.5381122867372,
    "labor_cost_per_hour": 24.854101246074762,
    "overtime_pct": 1.1980718843130587,
    "period_midpoint": "2025-05-18T12:00:00"
  },
  {
    "Period": "5/26-6/8",
    "Tips": 3979.81,
    "net_sales": 74117.33,
    "service_fee": 226.56,
    "total_payroll": 27946.51,
    "Tips_Distributed": 4769.12,
    "if_match": 562.75,
    "LaborCost_no_tips": 23177.39,
    "labor_cost/net_sales": 0.3127121552,
    "total_Labor_hour": 950.38,
    "OT_hour": null,
    "SPLH": 77.99,
    "HC": 16.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 23177.39,
    "TotalLaborCost/NetSales": 0.3127121552,
    "Unnamed: 23": null,
    "BOS（Boston）": "问题点：",
    "start_date": "2025-05-26T00:00:00",
    "end_date": "2025-06-08T00:00:00",
    "MP_LaborCost": 23177.39,
    "MP_TotalLaborCostExcludingTips": 23177.39,
    "total_labor_cost": 23177.39,
    "labor_cost_pct": 31.271215517342572,
    "sales_per_labor_hour": 77.98704728634863,
    "labor_cost_per_hour": 24.387497632525935,
    "overtime_pct": null,
    "period_midpoint": "2025-06-01T12:00:00"
  },
  {
    "Period": "6/9-6/22",
    "Tips": 3608.39,
    "net_sales": 66381.33,
    "service_fee": 512.06,
    "total_payroll": 26451.24,
    "Tips_Distributed": 4352.94,
    "if_match": 232.49,
    "LaborCost_no_tips": 22098.3,
    "labor_cost/net_sales": 0.3328993258,
    "total_Labor_hour": 909.25,
    "OT_hour": null,
    "SPLH": 69.85,
    "HC": 16.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 22098.3,
    "TotalLaborCost/NetSales": 0.3328993258,
    "Unnamed: 23": null,
    "BOS（Boston）": null,
    "start_date": "2025-06-09T00:00:00",
    "end_date": "2025-06-22T00:00:00",
    "MP_LaborCost": 22098.3,
    "MP_TotalLaborCostExcludingTips": 22098.3,
    "total_labor_cost": 22098.3,
    "labor_cost_pct": 33.28993257592157,
    "sales_per_labor_hour": 73.00668682980479,
    "labor_cost_per_hour": 24.303876821556226,
    "overtime_pct": null,
    "period_midpoint": "2025-06-15T12:00:00"
  },
  {
    "Period": "6/23-7/6",
    "Tips": 3558.94,
    "net_sales": 64256.16,
    "service_fee": 361.64,
    "total_payroll": 26114.69,
    "Tips_Distributed": 4232.05,
    "if_match": 311.47,
    "LaborCost_no_tips": 21882.64,
    "labor_cost/net_sales": 0.3405531859,
    "total_Labor_hour": 899.23,
    "OT_hour": null,
    "SPLH": 67.61,
    "HC": 16.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 21882.64,
    "TotalLaborCost/NetSales": 0.3405531859,
    "Unnamed: 23": null,
    "BOS（Boston）": "后期因为销售减少，未有效控制人工成本。",
    "start_date": "2025-06-23T00:00:00",
    "end_date": "2025-07-06T00:00:00",
    "MP_LaborCost": 21882.64,
    "MP_TotalLaborCostExcludingTips": 21882.64,
    "total_labor_cost": 21882.64,
    "labor_cost_pct": 34.05531858735411,
    "sales_per_labor_hour": 71.45686865429312,
    "labor_cost_per_hour": 24.334864272766698,
    "overtime_pct": null,
    "period_midpoint": "2025-06-29T12:00:00"
  },
  {
    "Period": "7/7-7/20",
    "Tips": 3797.3,
    "net_sales": 65586.24,
    "service_fee": 454.7,
    "total_payroll": 26148.85,
    "Tips_Distributed": 4549.57,
    "if_match": 297.57,
    "LaborCost_no_tips": 21599.28,
    "labor_cost/net_sales": 0.3293263953,
    "total_Labor_hour": 890.81,
    "OT_hour": null,
    "SPLH": 69.01,
    "HC": 16.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 21599.28,
    "TotalLaborCost/NetSales": 0.3293263953,
    "Unnamed: 23": null,
    "BOS（Boston）": null,
    "start_date": "2025-07-07T00:00:00",
    "end_date": "2025-07-20T00:00:00",
    "MP_LaborCost": 21599.28,
    "MP_TotalLaborCostExcludingTips": 21599.28,
    "total_labor_cost": 21599.28,
    "labor_cost_pct": 32.932639529267114,
    "sales_per_labor_hour": 73.62539711049496,
    "labor_cost_per_hour": 24.246786632390744,
    "overtime_pct": null,
    "period_midpoint": "2025-07-13T12:00:00"
  },
  {
    "Period": "7/21-8/3",
    "Tips": 4058.74,
    "net_sales": 68257.24,
    "service_fee": null,
    "total_payroll": 26428.8,
    "Tips_Distributed": 4726.52,
    "if_match": 667.78,
    "LaborCost_no_tips": 21702.28,
    "labor_cost/net_sales": 0.3179483964,
    "total_Labor_hour": 883.93,
    "OT_hour": 29.74,
    "SPLH": 77.22018712,
    "HC": 16.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 21702.28,
    "TotalLaborCost/NetSales": 0.3179483964,
    "Unnamed: 23": null,
    "BOS（Boston）": null,
    "start_date": "2025-07-21T00:00:00",
    "end_date": "2025-08-03T00:00:00",
    "MP_LaborCost": 21702.28,
    "MP_TotalLaborCostExcludingTips": 21702.28,
    "total_labor_cost": 21702.28,
    "labor_cost_pct": 31.79483963898921,
    "sales_per_labor_hour": 77.22018711888951,
    "labor_cost_per_hour": 24.552034663378322,
    "overtime_pct": 3.364519814917471,
    "period_midpoint": "2025-07-27T12:00:00"
  },
  {
    "Period": "8/4-8/17",
    "Tips": 3466.41,
    "net_sales": 63142.88,
    "service_fee": null,
    "total_payroll": 25538.48,
    "Tips_Distributed": 3866.0,
    "if_match": 399.59,
    "LaborCost_no_tips": 21672.48,
    "labor_cost/net_sales": 0.343229197,
    "total_Labor_hour": 870.2,
    "OT_hour": 30.72,
    "SPLH": 72.56134222,
    "HC": 16.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 21672.48,
    "TotalLaborCost/NetSales": 0.343229197,
    "Unnamed: 23": null,
    "BOS（Boston）": null,
    "start_date": "2025-08-04T00:00:00",
    "end_date": "2025-08-17T00:00:00",
    "MP_LaborCost": 21672.48,
    "MP_TotalLaborCostExcludingTips": 21672.48,
    "total_labor_cost": 21672.48,
    "labor_cost_pct": 34.32291970211052,
    "sales_per_labor_hour": 72.56134222017926,
    "labor_cost_per_hour": 24.905171225005745,
    "overtime_pct": 3.530222937255803,
    "period_midpoint": "2025-08-10T12:00:00"
  },
  {
    "Period": "8/18-8/31",
    "Tips": 4711.55,
    "net_sales": 81553.41,
    "service_fee": null,
    "total_payroll": 29067.52,
    "Tips_Distributed": 5108.92,
    "if_match": 397.37,
    "LaborCost_no_tips": 23958.6,
    "labor_cost/net_sales": 0.2937780284,
    "total_Labor_hour": 1224.4,
    "OT_hour": 147.8,
    "SPLH": 66.606836,
    "HC": 16.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 23958.6,
    "TotalLaborCost/NetSales": 0.2937780284,
    "Unnamed: 23": null,
    "BOS（Boston）": "建议：",
    "start_date": "2025-08-18T00:00:00",
    "end_date": "2025-08-31T00:00:00",
    "MP_LaborCost": 23958.6,
    "MP_TotalLaborCostExcludingTips": 23958.6,
    "total_labor_cost": 23958.6,
    "labor_cost_pct": 29.377802841107435,
    "sales_per_labor_hour": 66.60683600130676,
    "labor_cost_per_hour": 19.56762495916367,
    "overtime_pct": 12.071218556027443,
    "period_midpoint": "2025-08-24T12:00:00"
  },
  {
    "Period": "9/1-9/14",
    "Tips": 5178.77,
    "net_sales": 96484.07,
    "service_fee": null,
    "total_payroll": 29672.91,
    "Tips_Distributed": 5321.77,
    "if_match": 143.0,
    "LaborCost_no_tips": 24351.14,
    "labor_cost/net_sales": 0.2523850828,
    "total_Labor_hour": 1313.15,
    "OT_hour": 222.32,
    "SPLH": 73.47528462,
    "HC": 19.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 24351.14,
    "TotalLaborCost/NetSales": 0.2523850828,
    "Unnamed: 23": null,
    "BOS（Boston）": null,
    "start_date": "2025-09-01T00:00:00",
    "end_date": "2025-09-14T00:00:00",
    "MP_LaborCost": 24351.14,
    "MP_TotalLaborCostExcludingTips": 24351.14,
    "total_labor_cost": 24351.14,
    "labor_cost_pct": 25.238508284320922,
    "sales_per_labor_hour": 73.47528462094962,
    "labor_cost_per_hour": 18.544065795986747,
    "overtime_pct": 16.930282145984844,
    "period_midpoint": "2025-09-07T12:00:00"
  },
  {
    "Period": "9/15-9/28",
    "Tips": 5210.0,
    "net_sales": 100123.09,
    "service_fee": null,
    "total_payroll": 31755.67,
    "Tips_Distributed": 5332.0,
    "if_match": 122.0,
    "LaborCost_no_tips": 26423.67,
    "labor_cost/net_sales": 0.2614224151,
    "total_Labor_hour": 1307.34,
    "OT_hour": 208.18,
    "SPLH": 76.58534888,
    "HC": 16.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 26423.67,
    "TotalLaborCost/NetSales": 0.2639118509,
    "Unnamed: 23": null,
    "BOS（Boston）": "优化中后期用工结构；",
    "start_date": "2025-09-15T00:00:00",
    "end_date": "2025-09-28T00:00:00",
    "MP_LaborCost": 26423.67,
    "MP_TotalLaborCostExcludingTips": 26423.67,
    "total_labor_cost": 26423.67,
    "labor_cost_pct": 26.391185090272383,
    "sales_per_labor_hour": 76.58534887634434,
    "labor_cost_per_hour": 20.211781173986875,
    "overtime_pct": 15.923937154833482,
    "period_midpoint": "2025-09-21T12:00:00"
  },
  {
    "Period": "9/29-10/12",
    "Tips": 5801.18,
    "net_sales": 99930.7,
    "service_fee": null,
    "total_payroll": 30660.15,
    "Tips_Distributed": 4485.73,
    "if_match": -1315.45,
    "LaborCost_no_tips": 26174.42,
    "labor_cost/net_sales": 0.2619257145,
    "total_Labor_hour": 1210.82,
    "OT_hour": 188.54,
    "SPLH": 82.53142498,
    "HC": 18.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": 5023.68,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 5023.68,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 31198.1,
    "TotalLaborCost/NetSales": 0.3121973528,
    "Unnamed: 23": null,
    "BOS（Boston）": null,
    "start_date": "2025-09-29T00:00:00",
    "end_date": "2025-10-12T00:00:00",
    "MP_LaborCost": 26174.42,
    "MP_TotalLaborCostExcludingTips": 31198.1,
    "total_labor_cost": 31198.1,
    "labor_cost_pct": 31.219735276546643,
    "sales_per_labor_hour": 82.5314249847211,
    "labor_cost_per_hour": 25.766092400191607,
    "overtime_pct": 15.57126575378669,
    "period_midpoint": "2025-10-05T12:00:00"
  },
  {
    "Period": "10/13-10/26",
    "Tips": 5341.28,
    "net_sales": 99468.64,
    "service_fee": null,
    "total_payroll": 37269.57,
    "Tips_Distributed": 5358.91,
    "if_match": 17.63,
    "LaborCost_no_tips": 31910.66,
    "labor_cost/net_sales": 0.3208112627,
    "total_Labor_hour": 1417.53,
    "OT_hour": 227.19,
    "SPLH": 70.17039498,
    "HC": 19.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 31910.66,
    "TotalLaborCost/NetSales": 0.3208112627,
    "Unnamed: 23": null,
    "BOS（Boston）": "引入轮班交叉训练，提升人力利用率；",
    "start_date": "2025-10-13T00:00:00",
    "end_date": "2025-10-26T00:00:00",
    "MP_LaborCost": 31910.66,
    "MP_TotalLaborCostExcludingTips": 31910.66,
    "total_labor_cost": 31910.66,
    "labor_cost_pct": 32.08112627256188,
    "sales_per_labor_hour": 70.17039498282223,
    "labor_cost_per_hour": 22.51145302039463,
    "overtime_pct": 16.0271740280629,
    "period_midpoint": "2025-10-19T12:00:00"
  },
  {
    "Period": "10/27-11/09",
    "Tips": 5570.0,
    "net_sales": 105569.76,
    "service_fee": null,
    "total_payroll": 36719.89,
    "Tips_Distributed": 5681.0,
    "if_match": 111.0,
    "LaborCost_no_tips": 31038.89,
    "labor_cost/net_sales": 0.2940130772,
    "total_Labor_hour": 1391.33,
    "OT_hour": 180.49,
    "SPLH": 75.87686602,
    "HC": 20.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 31038.89,
    "TotalLaborCost/NetSales": 0.2940130772,
    "Unnamed: 23": null,
    "BOS（Boston）": null,
    "start_date": "2025-10-27T00:00:00",
    "end_date": "2025-11-09T00:00:00",
    "MP_LaborCost": 31038.89,
    "MP_TotalLaborCostExcludingTips": 31038.89,
    "total_labor_cost": 31038.89,
    "labor_cost_pct": 29.401307722969154,
    "sales_per_labor_hour": 75.87686602028275,
    "labor_cost_per_hour": 22.30879086916835,
    "overtime_pct": 12.97247956990793,
    "period_midpoint": "2025-11-02T12:00:00"
  },
  {
    "Period": "11/10-11/23",
    "Tips": 5810.71,
    "net_sales": 106763.88,
    "service_fee": null,
    "total_payroll": 36868.14,
    "Tips_Distributed": 5928.71,
    "if_match": 118.0,
    "LaborCost_no_tips": 30939.43,
    "labor_cost/net_sales": 0.2897930461,
    "total_Labor_hour": 1398.08,
    "OT_hour": 159.52,
    "SPLH": 76.36464294,
    "HC": 19.0,
    "Payroll_Dismissal": null,
    "Payroll_OffCycle": null,
    "Payroll_NonGusto": null,
    "Payroll_Fixing": null,
    "Payroll_Bonus": null,
    "Payroll_NewHire": null,
    "Payroll_NonRegularTotal": 0.0,
    "Other": null,
    "BOS_TotalLaborCostExcludingTips": 30939.43,
    "TotalLaborCost/NetSales": 0.2897930461,
    "Unnamed: 23": null,
    "BOS（Boston）": null,
    "start_date": "2025-11-10T00:00:00",
    "end_date": "2025-11-23T00:00:00",
    "MP_LaborCost": 30939.43,
    "MP_TotalLaborCostExcludingTips": 30939.43,
    "total_labor_cost": 30939.43,
    "labor_cost_pct": 28.97930461125991,
    "sales_per_labor_hour": 76.36464293888763,
    "labor_cost_per_hour": 22.129942492561227,
    "overtime_pct": 11.40993362325475,
    "period_midpoint": "2025-11-16T12:00:00"
  }
]
    </script>

    <div class="section">
        <h2>执行摘要</h2>
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="label">总净销售额</div>
                <div class="value">$2,135,929.21</div>
            </div>
            <div class="metric-card">
                <div class="label">总人工成本</div>
                <div class="value">$602,302.79</div>
            </div>
            <div class="metric-card">
                <div class="label">平均人工成本占比</div>
                <div class="value">28.20%</div>
            </div>
            <div class="metric-card">
                <div class="label">总人工工时</div>
                <div class="value">24,958.70</div>
            </div>
            <div class="metric-card">
                <div class="label">平均每小时销售额</div>
                <div class="value">$86.07</div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <h2>可视化分析</h2>
        <div class="chart-tabs">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('total', this)">总计</button>
                <button class="tab-button" onclick="switchTab('labor_cost', this)">Labor Cost</button>
                <button class="tab-button" onclick="switchTab('splh', this)">Sales Per Labor Hour</button>
                <button class="tab-button" onclick="switchTab('overtime', this)">Overtime</button>
            </div>
            
            <div id="tab-total" class="tab-content active">
                <div class="chart-image">
                    <canvas id="totalChart" style="max-width: 100%; height: 500px;"></canvas>
                </div>
            </div>
            
            <div id="tab-labor_cost" class="tab-content">
                <div class="chart-image">
                    <canvas id="laborCostChart" style="max-width: 100%; height: 500px;"></canvas>
                </div>
            </div>
            
            <div id="tab-splh" class="tab-content">
                <div class="chart-image">
                    <canvas id="splhChart" style="max-width: 100%; height: 500px;"></canvas>
                </div>
            </div>
            
            <div id="tab-overtime" class="tab-content">
                <div class="chart-image">
                    <canvas id="overtimeChart" style="max-width: 100%; height: 500px;"></canvas>
                </div>
            </div>
        </div>
    </div>
        <div class="section">
        <h2>关键指标</h2>
        <table id="keyMetricsTable">
            <tr>
                <th>指标</th>
                <th>数值</th>
            </tr>
            <tr>
                <td>分析时间段数</td>
                <td>23 个</td>
            </tr>
            <tr>
                <td>平均人工成本占比</td>
                <td>28.84%</td>
            </tr>
            <tr>
                <td>最低人工成本占比</td>
                <td>22.04% (时间段: 4/14-4/27)</td>
            </tr>
            <tr>
                <td>最高人工成本占比</td>
                <td>34.58% (时间段: 1/6-1/19)</td>
            </tr>
            <tr>
                <td>标准差</td>
                <td>4.05%</td>
            </tr>
            <tr>
                <td>平均每小时销售额 (SPLH)</td>
                <td>$86.07</td>
            </tr>
            <tr>
                <td>最佳 SPLH</td>
                <td>$112.38 (时间段: 4/14-4/27)</td>
            </tr>
            <tr>
                <td>最差 SPLH</td>
                <td>$66.61 (时间段: 8/18-8/31)</td>
            </tr>
            <tr>
                <td>平均加班工时占比</td>
                <td>7.54%</td>
            </tr>
            <tr>
                <td>总加班工时</td>
                <td>1,758.20 小时</td>
            </tr>
            <tr>
                <td>平均员工数量</td>
                <td>17.8 人</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <h2>按时间段详细分析</h2>
        <table id="periodTable">
            <thead>
                <tr>
                    <th>时间段</th>
                    <th>净销售额</th>
                    <th>人工成本</th>
                    <th>人工成本占比</th>
                    <th>每小时销售额</th>
                    <th>总工时</th>
                    <th>加班工时</th>
                    <th>加班占比</th>
                    <th>员工数量</th>
                    <th>OT涨跌幅</th>
                    <th>人工成本涨跌幅</th>
                </tr>
            </thead>
            <tbody id="periodTableBody">

            <tr data-period="11/10-11/23">
                <td>11/10-11/23</td>
                <td>$106,763.88</td>
                <td>$30,939.43</td>
                <td>28.98%</td>
                <td>$76.36</td>
                <td>1,398.08</td>
                <td>159.52</td>
                <td>11.41%</td>
                <td>19</td>
                <td style="color: #27ae60; font-weight: bold;">-11.62%</td>
                <td style="color: #27ae60; font-weight: bold;">-0.32%</td>
            </tr>

            </tbody>
        </table>
    </div>
    
    <div class="footer">
        <p>本报告由人工效率分析系统自动生成</p>
        <p>门店：{store_name if store_name else '未知'}</p>
    </div>
</body>
</html>
